<div *ngIf="isLoading">Loading...</div>
<div *ngIf="error">{{ error }}</div>

<div *ngIf="!isLoading && !error">
  <h2>Feedback Analysis</h2>

  <!-- Questionnaire selector -->
  <label>Select Questionnaire:</label>
  <select [value]="selectedQ?.id" (change)="selectQuestionById($any($event.target).value)">
    <option *ngFor="let q of questionnaires" [value]="q.id">
      {{ q.title }}
    </option>
  </select>

  <div *ngIf="selectedQ">
    <h3>{{ selectedQ?.title }}</h3>

    <!-- Questions -->
    <div *ngFor="let qq of selectedQ.questions">
      <h4>{{ qq.text }}</h4>

      <!-- Likert / Radio -->
      <div *ngIf="qq.type === 'radio'">
        <p>Average: {{ avgLikert(qq, responsesFor(selectedQ?.id || 0)) }}</p>
        <ul>
          <li *ngFor="let entry of (distribution(qq, responsesFor(selectedQ?.id || 0)) | keyvalue)">
            {{ entry.key }}: {{ entry.value }}
          </li>
        </ul>
      </div>

      <!-- Text responses -->
      <div *ngIf="qq.type === 'text'">
        <p>Responses:</p>
        <ul>
          <li *ngFor="let ans of textAnswers(qq, responsesFor(selectedQ?.id || 0))">
            {{ ans }}
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
